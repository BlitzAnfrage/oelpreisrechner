<!DOCTYPE html> <!-- Dokumenttyp: HTML5 -->
<html lang="de"> <!-- Sprache: Deutsch -->
<head> <!-- Kopfbereich beginnt -->
  <meta charset="UTF-8" /> <!-- Zeichensatz: UTF-8 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!-- Responsives Layout -->
  <title>Ölpreisrechner</title> <!-- Seitentitel -->
  <style> /* Eingebettetes CSS */
    :root{ /* Design-Variablen */
      --brand:#6EC054; --brand-dark:#4c7f2d; --ink:#222; --bg:#f7faf7; --card:#ffffff; /* Markenfarben */
      --muted:#6b6b6b; --ring:rgba(110,192,84,.25); --shadow:0 12px 30px rgba(0,0,0,.08); /* Effekte */
      /* ▼ Manuelle Tuning-Variablen für das Google‑Sheets‑Diagramm (einfach anpassen) */
      --chart-shift-x-desktop: 0px;   /* Diagramm nach links/rechts schieben (Desktop) */
      --chart-shift-x-mobile:  -12px;   /* Diagramm nach links/rechts schieben (Mobil) — leicht nach links für volle Sichtbarkeit */
      --chart-zoom-desktop:    1;     /* Diagramm zoomen (1 = 100%) (Desktop) */
      --chart-zoom-mobile:     0.85;  /* Mobil: kleiner skaliert, damit nichts abgeschnitten wird */
      --chart-max-width:       1000px;/* Max. Breite der Chart-Karte */
    }
    *{box-sizing:border-box} /* Einheitliche Box-Berechnung */
    html{font-size:15px; overflow-x:hidden} /* Grundschrift etwas kleiner + verhindert horizontales Scrollen */
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:var(--bg);color:var(--ink);font-weight:400;overflow-x:hidden} /* Basis-Layout & dünnere Schrift + keine horizontale Scrollbarkeit */

    header{background:var(--brand);position:relative;padding:26px 60px;text-align:center;color:#fff} /* Kopfbereich-Stil */
    .logo{height:40px} /* Logogröße */
    /* .back-button – entfernt aus dem Markup; CSS bleibt hier nur als Referenz */

    .hero{padding:2.5rem 1rem;background:#fff;text-align:center;border-bottom:1px solid #eef2ea} /* Hero-Bereich */
    .hero h1{color:#18510a;margin:0;font-size:clamp(1.4rem,2.1vw,1.9rem);font-weight:700;letter-spacing:.2px} /* Titel kleiner & prägnant */
    .hero p{margin:.45rem auto 0;max-width:1000px;color:#2d2d2d;font-size:1rem;font-weight:400} /* Untertitel dünner */

    .steps{max-width:1000px;margin:1rem auto;background:#fff;border-radius:14px;box-shadow:var(--shadow);padding:.8rem 1rem} /* Schritte-Container */
    .steps ol{list-style:none;display:grid;grid-template-columns:repeat(4,1fr);gap:.85rem;padding:0;margin:0} /* 4 gleich breite Spalten */
    .steps li{display:flex;gap:.65rem;align-items:flex-start;padding:.6rem .6rem;border-radius:10px} /* Einheitlicher Innenabstand je Punkt */
    .steps .dot{flex:0 0 30px;height:30px;border-radius:50%;background:var(--brand);color:#fff;font-weight:800;display:flex;align-items:center;justify-content:center;font-size:.95rem} /* Nummern-Badge */
    .steps .txt{font-size:.9rem;line-height:1.25} /* Text etwas kleiner als Überschrift */
    .steps .txt strong{font-weight:700} /* Schrittüberschrift hervorgehoben */

    .form-wrap{padding:1.2rem} /* Außenabstand zum Formular */
    .form{max-width:1000px;margin:0 auto;background:var(--card);border:1px solid #e8efe3;border-radius:16px;padding:22px 22px 26px;box-shadow:var(--shadow)} /* Formular-Karte */
    .row{display:grid;grid-template-columns:1fr 1fr;gap:26px;margin-bottom:22px} /* Zwei Spalten + gleichmäßiger Zeilenabstand (Desktop & Mobil) */
    .form-group{display:flex;flex-direction:column} /* Gruppierung */
    label{font-weight:600;font-size:.92rem;margin-bottom:.35rem;color:#1f2b1c} /* Labels schlanker */
    input[type="text"],select{border:1.7px solid #d9e3d3;border-radius:10px;padding:10px 12px;font-size:.95rem;outline:none;transition:.2s;background:#fff} /* Inputs */
    input[type="text"]:focus,select:focus{border-color:var(--brand-dark);box-shadow:0 0 0 4px var(--ring)} /* Fokus-Ring */

    .range-wrap{position:relative;padding-top:22px} /* Wrapper für Slider + Bubble */
    #oilRange{width:100%;appearance:none;height:10px;border-radius:999px;background:linear-gradient(to right,#60993B 0%,#60993B 0%,#e0e0e0 0%,#e0e0e0 100%);outline:none;cursor:pointer} /* Slider-Track */
    #oilRange::-webkit-slider-thumb{appearance:none;height:22px;width:22px;border-radius:50%;background:#fff;border:3px solid var(--brand);box-shadow:0 2px 8px rgba(0,0,0,.25)} /* Thumb (WebKit) */
    #oilRange::-moz-range-thumb{height:22px;width:22px;border-radius:50%;background:#fff;border:3px solid var(--brand)} /* Thumb (Firefox) */

    .value-bubble{position:absolute;top:0;transform:translateX(-50%);background:#1a3f10;color:#fff;padding:6px 10px;border-radius:999px;font-weight:700;font-size:.85rem;box-shadow:0 6px 14px rgba(0,0,0,.18)} /* Dynamische Preis-/Mengenblase */
    .value-bubble::after{content:"";position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#1a3f10} /* Pfeil unter der Blase */

    .ticks{display:flex;justify-content:space-between;margin-top:8px;margin-bottom:12px;color:#444;font-weight:600;font-size:.85rem} /* Skalenwerte + mehr Abstand nach unten (Desktop) */

    .premium-card{border:1px solid #e8efe3;border-radius:12px;padding:14px;background:#fbfdf9} /* Premium-Block */
    .switch{position:relative;display:inline-flex;align-items:center;gap:.6rem} /* Toggle-Container */
    .switch input{position:absolute;left:0;top:0;width:48px;height:26px;opacity:0;cursor:pointer} /* Klickfläche deckt den sichtbaren Schalter komplett ab → funktionsfähig */
    .slider{width:48px;height:26px;border-radius:999px;background:#d9e3d3;position:relative;transition:.2s;cursor:pointer} /* Schalter-Hintergrund */
    .slider::after{content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;background:#fff;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,.25);transition:.2s} /* Schalter-Knopf */
    .switch input:checked + .slider{background:var(--brand)} /* Aktiv-Hintergrund */
    .switch input:checked + .slider::after{left:25px} /* Knopf rechts bei aktiv */
    .switch-label{font-weight:700;font-size:.95rem} /* Schalter-Text */

    details{margin-top:.35rem} /* Info-Toggle Abstand */
    details summary{cursor:pointer;font-weight:600;color:#224219;outline:none} /* Zusammenfassung klickbar */
    details[open] summary{color:#142d0e} /* Farbe wenn geöffnet */
    .info{font-size:.9rem;color:#233221;line-height:1.45} /* Info-Text schlank */

    .btn{margin-top:6px;width:100%;background:var(--brand);color:#fff;border:none;border-radius:10px;padding:14px;font-weight:700;font-size:1rem;cursor:pointer;transition:transform .02s,background .15s} /* Hauptbutton */
    .btn:hover,.btn:focus{background:var(--brand-dark);outline:none} /* Hover/Focus */
    .btn:active{transform:translateY(1px)} /* Klick-Feedback */

    .footer{margin-top:34px;background:var(--brand);color:#fff;text-align:center;padding:24px 12px;font-size:.95rem} /* Fußzeile */

    .chart-card{max-width:var(--chart-max-width);width:100%;margin:34px auto 0;background:#fff;border-radius:16px;box-shadow:var(--shadow);padding:0 0 8px;border:1px solid #e8efe3;overflow:hidden} /* Diagramm-Card */
    .chart-tune{ /* Hülle zum manuellen Verschieben/Zoomen des Diagramms */
      transform:translateX(var(--chart-shift-x-desktop)) scale(var(--chart-zoom-desktop)); /* Desktop-Shift/Zoon */
      transform-origin:top left; /* Transformation relativ zur linken Kante */
    }
    .chart-inner{position:relative;padding-bottom:56.25%;height:0;overflow:hidden} /* 16:9-Wrapper */
    .chart-inner iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0} /* Iframe füllt Wrapper */
    .legend{display:flex;gap:28px;justify-content:center;padding:8px 8px 12px;color:#333;font-weight:600;font-size:.9rem} /* Legende */
    .legend .line{width:28px;height:4px;border-radius:2px;display:inline-block} /* Farblinie */
    .blue{background:#007bff}.red{background:#dc3545}.yellow{background:#ffc107} /* Legendenfarben */

    /* ▼▼▼ NEU: Popup/Modal für das Diagramm (zeigt Chart passend zur Bildschirmgröße) */
    .chart-open{display:none;margin:10px auto 12px;background:var(--brand);color:#fff;border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer} /* Button: Diagramm in Popup öffnen (mobil sichtbar) */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9999} /* Vollflächiger Overlay-Hintergrund */
    .modal[aria-hidden="false"]{display:flex} /* Sichtbar, sobald aria-hidden=false */
    .modal__panel{width:min(1000px,92vw);height:min(80vh,92vh);background:#fff;border-radius:14px;box-shadow:var(--shadow);overflow:hidden;position:relative} /* Panel mit responsiven Maximalmaßen */
    .modal__close{position:absolute;top:8px;right:10px;background:#fff;border:1px solid #e5e7eb;border-radius:999px;width:36px;height:36px;font-size:20px;line-height:34px;text-align:center;cursor:pointer} /* Schließen-Button */
    .modal__body{position:absolute;inset:48px 12px 12px 12px} /* Platz für Close-Button oben */
    .modal__body iframe{width:100%;height:100%;border:0} /* Iframe füllt das Panel */
    /* ▲▲▲ NEU: Ende Modal */

    /* Desktop-Feintuning: mehr Abstand unter Liefermenge & bündige 4-Schritte-Karten */
    @media (min-width:901px){
      .ticks{margin-bottom:18px} /* Desktop: etwas mehr Abstand unter Liefermenge */
      .form{padding-bottom:32px} /* Desktop: mehr Luft am unteren Rand des Formulars */
      .steps ol{align-items:stretch} /* Desktop: Grid streckt alle vier Punkte gleich hoch */
      .steps li{min-height:96px} /* Desktop: bündige Darstellung der vier Punkte */

      /* ▼ Zusätzliche Abstände zwischen den Containern (nur Desktop) */
      .steps{margin:1.6rem auto 2.2rem}
      .form-wrap{padding-top:2rem; padding-bottom:2.2rem}
      .footer{margin-top:48px}
    }

    @media (max-width:900px){ /* Mobile-Anpassungen */
      .steps ol{grid-template-columns:1fr 1fr} /* 2 Spalten auf kleineren Screens */
      .row{grid-template-columns:1fr;margin-bottom:24px} /* Einspaltiges Formular + mehr Abstand zwischen den Reihen (PLZ ↔ Abladestellen) */
      header{padding:24px 22px} /* Kompakter Header */
      .chart-tune{transform:translateX(var(--chart-shift-x-mobile)) scale(var(--chart-zoom-mobile)); display:none !important} /* Mobil: Inline‑Chart ausblenden (Popup übernimmt) */
      .chart-open{display:block} /* Mobil: Button zum Öffnen des Popups anzeigen */
      .modal__panel{width:70vw;height:40vh} /* ▼ NEU: Mobil – deutlich kleineres Popup für den Graphen */
    }
  </style> <!-- Ende CSS -->
</head> <!-- Kopfbereich endet -->
<body> <!-- Seitenkörper beginnt -->
  <header> <!-- Kopfbereich -->
    <img src="https://onecdn.io/media/61c27ecc-efc9-4840-9ff3-d13f96ec1316/full" alt="Logo" class="logo" /> <!-- Logo -->
    <!-- Zurück-zur-Website-Button wurde auf Wunsch komplett entfernt -->
  </header>

  <section class="hero" aria-labelledby="h1"> <!-- Einleitender Bereich -->
    <h1 id="h1">Heizöl Preisrechner – Raiffeisenmarkt Wiesbach im Saarland</h1> <!-- Titel (gewünscht) -->
    <p>Berechnen Sie Ihren Heizölpreis schnell und bequem – ganz einfach online und sofort verfügbar.</p> <!-- Untertitel (gewünscht) -->
  </section>

  <section class="steps" aria-label="Schritte"> <!-- Schritte-Container -->
    <ol> <!-- Auflistung der 4 Schritte -->
      <li><div class="dot">1</div><div class="txt"><strong>Daten eingeben</strong><br><span>PLZ, Liefermenge &amp; Versandart wählen</span></div></li> <!-- Schritt 1 (gewünscht) -->
      <li><div class="dot">2</div><div class="txt"><strong>Preis berechnen</strong><br><span>Individuellen Preis berechnen lassen</span></div></li> <!-- Schritt 2 (gewünscht) -->
      <li><div class="dot">3</div><div class="txt"><strong>Bestellung abschicken</strong><br><span>Persönliche Daten bestätigen &amp; Formular verbindlich absenden</span></div></li> <!-- Schritt 3 (gewünscht) -->
      <li><div class="dot">4</div><div class="txt"><strong>Lieferung &amp; Zahlung</strong><br><span>Bezahlung bei Lieferung oder per Vorabüberweisung</span></div></li> <!-- Schritt 4 (gewünscht) -->
    </ol>
  </section>

  <section class="form-wrap"> <!-- Formularbereich -->
    <form id="oilForm" class="form" novalidate> <!-- Hauptformular -->
      <div class="row"> <!-- Erste Zeile: Menge & PLZ -->
        <div class="form-group"> <!-- Feld: Menge -->
          <label for="oilRange">Liefermenge (Liter)</label> <!-- Label für Slider -->
          <div class="range-wrap"> <!-- Wrapper für Slider & Bubble -->
            <input type="range" id="oilRange" min="100" max="15000" step="100" value="500" oninput="updateSlider(this)" /> <!-- Slider-Eingabe -->
            <div class="value-bubble" id="oilBubble" aria-live="polite">500 L</div> <!-- Dynamische Blase über dem Slider -->
          </div>
          <div class="ticks"><span>100</span><span>5.000</span><span>10.000</span><span>15.000</span></div> <!-- Skalenmarken -->
        </div>
        <div class="form-group"> <!-- Feld: PLZ -->
          <label for="plz">Postleitzahl</label> <!-- Label für PLZ -->
          <input type="text" id="plz" name="plz" maxlength="5" inputmode="numeric" pattern="\d{5}" required placeholder="z. B. 66557" /> <!-- PLZ-Eingabe -->
          <p id="errMsg" style="display:none;color:#b00020;font-weight:600;margin:.35rem 0 0" aria-live="assertive">Die eingegebene PLZ liegt nicht im Liefergebiet.</p> <!-- Fehlermeldung -->
        </div>
      </div>

      <div class="row"> <!-- Zweite Zeile: Abladestellen & Premium -->
        <div class="form-group"> <!-- Feld: Abladestellen -->
          <label for="ablade">Anzahl der Abladestellen</label> <!-- Label -->
          <select id="ablade" name="ablade" required> <!-- Auswahl Abladestellen -->
            <option value="1">1</option> <!-- Option 1 -->
            <option value="2">2</option> <!-- Option 2 -->
            <option value="3">3</option> <!-- Option 3 -->
            <option value="4">4</option> <!-- Option 4 -->
            <option value="5">5</option> <!-- Option 5 -->
          </select>
        </div>

        <div class="form-group"> <!-- Feld: Premium-Heizöl -->
          <div class="premium-card" role="group" aria-labelledby="premiumTitle"> <!-- Premium-Karte -->
            <div class="switch"> <!-- Toggle-Zeile -->
              <input type="checkbox" id="premium" aria-describedby="premiumHint" /> <!-- Checkbox Premium (zugänglich) → funktionsfähig dank großer Klickfläche -->
              <span class="slider" aria-hidden="true"></span> <!-- Optische Schalterspur (klickbar) -->
              <label for="premium" class="switch-label" id="premiumTitle">Premium Heizöl</label> <!-- Titel des Toggles -->
            </div>
            <small id="premiumHint" class="muted" style="display:block;color:#315227;margin-top:.3rem">Aufpreis: +1,50 € je 100 L – wird bei der Berechnung berücksichtigt.</small> <!-- Kurzhinweis -->
            <details> <!-- Aufklappbarer Info-Bereich -->
              <summary>Wissenswertes zu Premium Heizöl</summary> <!-- Überschrift Info -->
              <div class="info"> <!-- Info-Text -->
                <p>Für alle Ölheizungen geeignet – nach <a href="https://de.wikipedia.org/wiki/Heiz%C3%B6l" target="_blank" rel="noopener">DIN 51603-1</a>.</p> <!-- Norm-Link -->
                <ul>
                  <li>Mit Additivpaket: reduzierter Verbrauch</li> <!-- Vorteil -->
                  <li>Längere Lebensdauer der Anlage</li> <!-- Vorteil -->
                  <li>Weniger Wartungsaufwand</li> <!-- Vorteil -->
                  <li>Höhere Betriebssicherheit</li> <!-- Vorteil -->
                  <li>Angenehmer Geruch</li> <!-- Vorteil -->
                  <li>Umweltschonend (max. 0,005 % Schwefel)</li> <!-- Vorteil -->
                </ul>
                <p>Das Additiv (Wirkstoff) wird mittels Dosiereinrichtung beim Abtanken beigemischt.</p> <!-- Zusatzinfo -->
              </div>
            </details>
          </div>
        </div>
      </div>

      <button class="btn" id="submitBtn" type="submit">Preis berechnen</button> <!-- Absende-Button -->
    </form>
  </section>

  <!-- Entfernt: leerer Mini-Container unter dem Formular (ehemalige .chart-card) -->

  <footer class="footer"> <!-- Fußzeile -->
    <p>© 2025 Raiffeisenmarkt Wiesbach – Alle Rechte vorbehalten</p> <!-- Copyright -->
  </footer>

  <!-- ▼▼▼ NEU: Modal-Markup für das Diagramm (Popup) -->
  <div class="modal" id="chartModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="chartTitle"> <!-- Overlay-Container -->
    <div class="modal__panel"> <!-- Panel (zentriert & responsiv) -->
      <button class="modal__close" type="button" id="closeChartBtn" aria-label="Popup schließen">×</button> <!-- Schließen-Button -->
      <div class="modal__body"> <!-- Inhalt des Modals -->
        <h2 id="chartTitle" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden">Preis-Chart</h2> <!-- Visually hidden Titel für Screenreader -->
        <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSgDaArv9UgKthAI2xg0BfJXxqJ6yUCqQZzlbytuz4KAUEPXKAeyteb45S943v2a_Hq4E2XAvidKalW/pubchart?oid=1568395756&amp;format=interactive" title="Preis-Chart (Vollbild)"></iframe> <!-- Chart im Popup: passt sich der Panelgröße an -->
      </div>
    </div>
  </div>
  <!-- ▲▲▲ NEU: Ende Modal-Markup -->

  <script> // Interaktives Verhalten
    // --- Referenzen holen ---
    const oilSlider = document.getElementById('oilRange'); // Slider-Element
    const oilBubble = document.getElementById('oilBubble'); // Blase über dem Slider
    const FORM = document.getElementById('oilForm'); // Formular-Referenz
    const BTN  = document.getElementById('submitBtn'); // Absende-Button
    const ERR  = document.getElementById('errMsg'); // Fehlermeldung für PLZ

    // --- Slider UI aktualisieren (Füllung + Blasenposition) ---
    function updateSlider(slider){ // Wird bei Eingabe aufgerufen
      const value = parseInt(slider.value,10); // Aktuellen Wert als Zahl lesen
      oilBubble.textContent = value.toLocaleString('de-DE') + ' L'; // Text der Blase aktualisieren
      const min = parseInt(slider.min,10), max = parseInt(slider.max,10); // Grenzen lesen
      const pct = ((value - min) / (max - min)) * 100; // Prozentposition berechnen
      slider.style.background = `linear-gradient(to right, #60993B 0%, #60993B ${pct}%, #e0e0e0 ${pct}%, #e0e0e0 100%)`; // Track-Füllung setzen
      const clamp = Math.max(2, Math.min(98, pct)); // Klemmen, damit die Blase nicht an den Rand klebt
      oilBubble.style.left = `calc(${clamp}% )`; // Blase horizontal positionieren
    }
    updateSlider(oilSlider); // Initiale Position setzen

    // --- Liefergebiets-PLZ-Listen (statisch wie besprochen) ---
    const area1 = ["66260","66262","66265","66272","66273","66274","66275","66280","66281","66282","66284","66287","66288","66289","66292","66293","66294","66295","66299","66337","66338","66340","66341","66346","66511","66512","66513","66514","66515","66516","66517","66518","66519","66520","66521","66522","66531","66538","66539","66540","66549","66550","66552","66553","66557","66558","66559","66560","66564","66565","66566","66567","66571","66572","66573","66575","66578","66579","66580","66583","66584","66585","66587","66589","66591","66592","66593","66594","66595","66596","66597","66630","66631","66632","66633","66636","66641","66642","66643","66646","66791","66792","66793","66807","66809","66811","66812","66813","66814","66819","66822","66832","66833","66835","66836","66839"]; // PLZ für Area 1
    const area2 = ["66459","66640","66629","66701","66740","66763","66773","66774","66775","66777","66787","66780","66794","66795","66798","66802","66000","66001","66002","66003","66004","66005","66006","66007","66008","66009","66010","66011","66012","66013","66014","66015","66016","66017","66019","66020","66021","66022","66023","66024","66025","66026","66027","66028","66029","66030","66031","66032","66033","66042","66043","66044","66045","66046","66047","66051","66053","66055","66057","66059","66060","66061","66063","66065","66067","66090","66091","66092","66093","66094","66095","66099","66100","66101","66102","66103","66104","66105","66106","66107","66108","66109","66111","66113","66115","66117","66119","66121","66123","66125","66126","66127","66128","66129","66130","66131","66132","66133","66140","66141","66142","66143","66150","66200","66259","66353","66354","66355","66359","66361","66362","66363","66364","66365","66366","66367","66368","66369","66370","66376","66377","66386","66803","66804","66806","66333"]; // PLZ für Area 2
    const area3 = ["66687","66129","66130","66629","66271","66352","66399","66424","66679","66693","66706","66709","66780","66798","66802","66440","66453","66620","66625","66663"]; // PLZ für Area 3

    function areaByPlz(plz){ // Ermittelt Area-String anhand PLZ
      if (area1.includes(plz)) return 'Area 1'; // Treffer Area 1
      if (area2.includes(plz)) return 'Area 2'; // Treffer Area 2
      if (area3.includes(plz)) return 'Area 3'; // Treffer Area 3
      return ''; // Nicht im Liefergebiet
    }

    // --- Eingabe validieren (PLZ live prüfen) ---
    document.getElementById('plz').addEventListener('input', (e)=>{ // Event bei PLZ-Eingabe
      const plz = e.target.value.replace(/\D+/g,'').slice(0,5); // Nur Ziffern, max. 5
      e.target.value = plz; // Wert im Feld aktualisieren
      const a = areaByPlz(plz); // Area ermitteln
      ERR.style.display = a ? 'none' : (plz.length === 5 ? 'block' : 'none'); // Fehler nur bei 5-stelliger ungültiger PLZ zeigen
    });

    // --- Premium-Toggle zusätzlich klickbar machen (Fallback, falls CSS-Klickfläche nicht greift) ---
    const premiumCheckbox = document.getElementById('premium'); // Checkbox-Referenz
    const premiumSlider   = document.querySelector('.switch .slider'); // Sichtbarer Slider
    if (premiumSlider){ premiumSlider.addEventListener('click', ()=>{ premiumCheckbox.checked = !premiumCheckbox.checked; }); } // Klick auf die Spur toggelt den Zustand

    // --- Formular absenden -> JSON zu n8n (genaues Format) ---
    FORM.addEventListener('submit', async (ev)=>{ // Submit-Handler
      ev.preventDefault(); // Standard-Submit verhindern

      const liefermenge   = parseInt(oilSlider.value,10); // Menge (Zahl)
      const plz           = document.getElementById('plz').value.trim(); // PLZ (String)
      const abladestellen = parseInt(document.getElementById('ablade').value,10); // Abladestellen (Zahl)
      const premium       = document.getElementById('premium').checked; // Premium-Checkbox (Boolean)
      const area          = areaByPlz(plz); // Area anhand PLZ bestimmen

      if (!area){ ERR.style.display='block'; return; } // Abbruch wenn außerhalb Liefergebiet

      const payload = { liefermenge, plz, abladestellen, area, premium }; // JSON-Objekt für n8n (inkl. premium)

      BTN.disabled = true; BTN.textContent = 'Berechne…'; // Button sperren + Status zeigen
      try{ // Netzwerkaufruf absichern
        const res = await fetch('https://n8n.srv899952.hstgr.cloud/webhook/oelrechner',{ // Webhook-URL (n8n)
          method:'POST', // POST-Methode
          headers:{ 'Content-Type':'application/json' }, // JSON-Header
          body: JSON.stringify(payload) // Body als JSON senden
        });
        const text = await res.text(); // Antwort als Text lesen
        if(!res.ok) throw new Error('HTTP '+res.status+' | '+text.slice(0,200)); // Fehler falls nicht 2xx
        let data; try{ data = JSON.parse(text) } catch{ throw new Error('Antwort kein JSON: '+text.slice(0,200)); } // JSON parsen
        const result = Array.isArray(data) ? data[0] : data; // Array- oder Objektform akzeptieren

        sessionStorage.setItem('oelForm', JSON.stringify({ // Ergebnis im Browser speichern
          eingabe: { liefermenge, plz, abladestellen, area, premium }, // Eingabedaten (für seite2)
          berechnung: result, // n8n-Berechnungsresultat
          timestamp: Date.now() // Zeitstempel
        }));

        window.location.href = './seite2.html'; // Weiter zu Seite 2
      } catch(err){ // Fehlerbehandlung
        alert('Fehler: '+err.message); // Meldung anzeigen
      } finally {
        BTN.disabled = false; BTN.textContent = 'Preis berechnen'; // Button wieder freigeben
      }
    });

    // ▼▼▼ NEU: Logik für das Chart-Popup (öffnet das Diagramm responsiv, verhindert horizontales Scrollen)
    const openChartBtn = document.getElementById('openChartBtn'); // Button: Popup öffnen
    const chartModal   = document.getElementById('chartModal');   // Modal-Overlay
    const closeChartBtn= document.getElementById('closeChartBtn'); // Button: Popup schließen

    function openModal(){
      chartModal.setAttribute('aria-hidden','false'); // Modal sichtbar machen
      document.body.style.overflow = 'hidden';        // Scrollen der Seite während des Popups deaktivieren
    }
    function closeModal(){
      chartModal.setAttribute('aria-hidden','true');  // Modal verbergen
      document.body.style.overflow = '';              // Seite wieder scrollbar
    }

    if(openChartBtn){ openChartBtn.addEventListener('click', openModal); } // Öffnen per Button (mobil)
    if(closeChartBtn){ closeChartBtn.addEventListener('click', closeModal); } // Schließen per X
    if(chartModal){ chartModal.addEventListener('click', (e)=>{ if(e.target===chartModal) closeModal(); }); } // Klick auf Overlay schließt
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); }); // ESC schließt
    // ▲▲▲ Ende Popup-Logik
  </script> <!-- Ende Script -->
</body> <!-- Seitenkörper endet -->
</html> <!-- Dokumentende -->
