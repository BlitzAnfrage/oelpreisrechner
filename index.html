<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ölpreisrechner</title>
  <!-- Favicon -->
  <link rel="icon" href="https://onecdn.io/media/96d496c9-3b9e-451e-ab59-264290e9b0cf/full" sizes="any" />
  <meta name="theme-color" content="#6EC054" />
  <style>
    :root{
      --brand:#6EC054; --brand-dark:#4c7f2d; --ink:#222; --bg:#f7faf7; --card:#ffffff;
      --muted:#6b6b6b; --ring:rgba(110,192,84,.25); --shadow:0 12px 30px rgba(0,0,0,.08);
      --chart-shift-x-desktop: 0px;
      --chart-shift-x-mobile:  -12px;
      --chart-zoom-desktop:    1;
      --chart-zoom-mobile:     0.85;
      --chart-max-width:       1000px;
    }
    *{box-sizing:border-box}
    html{font-size:15px; overflow-x:hidden; width:100%; max-width:100vw}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:var(--bg);color:var(--ink);font-weight:400;overflow-x:hidden; width:100%; max-width:100vw; overscroll-behavior-x:none; touch-action:pan-y; -webkit-text-size-adjust:100%}

    header{background:var(--brand);position:relative;text-align:center;color:#fff;
      padding:26px 60px;
      padding-top:calc(26px + constant(safe-area-inset-top));
      padding-left:calc(60px + constant(safe-area-inset-left));
      padding-right:calc(60px + constant(safe-area-inset-right));
      padding-top:calc(26px + env(safe-area-inset-top));
      padding-left:calc(60px + env(safe-area-inset-left));
      padding-right:calc(60px + env(safe-area-inset-right));
    }
    .logo{height:40px}

    .hero{padding:2.5rem 1rem;background:#fff;text-align:center;border-bottom:1px solid #eef2ea}
    /* Überschrift grün hinterlegt (wie im Anhang) */
    .hero h1{margin:0;font-size:clamp(1.4rem,2.1vw,1.9rem);font-weight:700;letter-spacing:.2px;display:inline-block;background:var(--brand);color:#fff;padding:.55rem .9rem;border-radius:10px}
    .hero p{margin:.75rem auto 0;max-width:1000px;color:#2d2d2d;font-size:1rem;font-weight:400}

    /* Bildbereich wurde entfernt → Styles optional belassen (keine Wirkung) */
    .hero-media{display:none}

    .steps{max-width:1000px;margin:1rem auto;background:#fff;border-radius:14px;box-shadow:var(--shadow);padding:.8rem 1rem}
    .steps ol{list-style:none;display:grid;grid-template-columns:repeat(4,1fr);gap:.85rem;padding:0;margin:0}
    .steps li{display:flex;gap:.65rem;align-items:flex-start;padding:.6rem .6rem;border-radius:10px}
    .steps .dot{flex:0 0 30px;height:30px;border-radius:50%;background:var(--brand);color:#fff;font-weight:800;display:flex;align-items:center;justify-content:center;font-size:.95rem}
    .steps .txt{font-size:.9rem;line-height:1.25}
    .steps .txt strong{font-weight:700}

    .form-wrap{padding:1.2rem}
    .form{max-width:1000px;margin:0 auto;background:var(--card);border:1px solid #e8efe3;border-radius:16px;padding:22px 22px 26px;box-shadow:var(--shadow)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:26px;margin-bottom:22px}
    .form-group{display:flex;flex-direction:column}
    label{font-weight:600;font-size:.92rem;margin-bottom:.35rem;color:#1f2b1c}
    input[type="text"],select{border:1.7px solid #d9e3d3;border-radius:10px;padding:10px 12px;font-size:.95rem;outline:none;transition:.2s;background:#fff}
    input[type="text"]:focus,select:focus{border-color:var(--brand-dark);box-shadow:0 0 0 4px var(--ring)}
    input[type="number"]{border:1.7px solid #d9e3d3;border-radius:10px;padding:10px 12px;font-size:.95rem;outline:none;transition:.2s;background:#fff}
    input[type="number"]:focus{border-color:var(--brand-dark);box-shadow:0 0 0 4px var(--ring)}
    .number-wrap{position:relative}
    .unit-input{display:flex;align-items:center;gap:8px}
    .unit-input .unit{font-weight:700;color:#1f2b1c}
    .hint{display:block;margin-top:.35rem;color:#315227}

    .range-wrap{position:relative;padding-top:22px}
    #oilRange{width:100%;}

    .value-bubble{display:none}
    .ticks{display:none}

    .premium-card{border:1px solid #e8efe3;border-radius:12px;padding:14px;background:#fbfdf9}
    .switch{position:relative;display:inline-flex;align-items:center;gap:.6rem}
    .switch input{position:absolute;left:0;top:0;width:48px;height:26px;opacity:0;cursor:pointer}
    .slider{width:48px;height:26px;border-radius:999px;background:#d9e3d3;position:relative;transition:.2s;cursor:pointer}
    .slider::after{content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;background:#fff;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,.25);transition:.2s}
    .switch input:checked + .slider{background:var(--brand)}
    .switch input:checked + .slider::after{left:25px}
    .switch-label{font-weight:700;font-size:.95rem}

    details{margin-top:.35rem}
    details summary{cursor:pointer;font-weight:600;color:#224219;outline:none}
    details[open] summary{color:#142d0e}
    .info{font-size:.9rem;color:#233221;line-height:1.45}

    .btn{margin-top:6px;width:100%;background:var(--brand);color:#fff;border:none;border-radius:10px;padding:14px;font-weight:700;font-size:1rem;cursor:pointer;transition:transform .02s,background .15s}
    .btn:hover,.btn:focus{background:var(--brand-dark);outline:none}
    .btn:active{transform:translateY(1px)}

    .footer{margin-top:34px;background:var(--brand);color:#fff;text-align:center;padding:24px 12px;font-size:.95rem}
    .footer a{color:#fff;text-decoration:underline}

    .chart-card{max-width:var(--chart-max-width);width:100%;margin:34px auto 0;background:#fff;border-radius:16px;box-shadow:var(--shadow);padding:0 0 8px;border:1px solid #e8efe3;overflow:hidden}
    .chart-tune{transform:translateX(var(--chart-shift-x-desktop)) scale(var(--chart-zoom-desktop));transform-origin:top left}
    .chart-inner{position:relative;padding-bottom:56.25%;height:0;overflow:hidden}
    .chart-inner iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
    .legend{display:flex;gap:28px;justify-content:center;padding:8px 8px 12px;color:#333;font-weight:600;font-size:.9rem}
    .legend .line{width:28px;height:4px;border-radius:2px;display:inline-block}
    .blue{background:#007bff}.red{background:#dc3545}.yellow{background:#ffc107}

    .chart-open{display:none;margin:10px auto 12px;background:var(--brand);color:#fff;border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal[aria-hidden="false"]{display:flex}
    .modal__panel{width:min(1000px,92vw);height:min(80vh,92vh);background:#fff;border-radius:14px;box-shadow:var(--shadow);overflow:hidden;position:relative}
    .modal__close{position:absolute;top:8px;right:10px;background:#fff;border:1px solid #e5e7eb;border-radius:999px;width:36px;height:36px;font-size:20px;line-height:34px;text-align:center;cursor:pointer}
    .modal__body{position:absolute;inset:48px 12px 12px 12px}
    .modal__body iframe{width:100%;height:100%;border:0}

    img, iframe{max-width:100%; height:auto}

    @media (min-width:901px){
      .ticks{margin-bottom:18px}
      .form{padding-bottom:32px}
      .steps ol{align-items:stretch}
      .steps li{min-height:96px}
      .steps{margin:1.6rem auto 2.2rem}
      .form-wrap{padding-top:2rem; padding-bottom:2.2rem}
      .footer{margin-top:48px}
    }

    @media (max-width:900px){
      .steps ol{grid-template-columns:1fr 1fr}
      .row{grid-template-columns:1fr;margin-bottom:24px}
      header{
        padding:24px 22px;
        padding-top:calc(24px + constant(safe-area-inset-top));
        padding-left:calc(22px + constant(safe-area-inset-left));
        padding-right:calc(22px + constant(safe-area-inset-right));
        padding-top:calc(24px + env(safe-area-inset-top));
        padding-left:calc(22px + env(safe-area-inset-left));
        padding-right:calc(22px + env(safe-area-inset-right));
      }
      .chart-tune{transform:translateX(var(--chart-shift-x-mobile)) scale(var(--chart-zoom-mobile)); display:none !important}
      .chart-open{display:block}
      .modal__panel{width:70vw;height:40vh}
    }

    /* ===== NUR hinzugefügt: Chart UI (ohne bestehende Styles zu verändern) ===== */
    .chart-head{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;padding:14px 16px;border-bottom:1px solid #eef3ec;flex-wrap:wrap}
    .chart-title{font-weight:900;color:#184b10;font-size:1.05rem}
    .chart-sub{color:#66736a;font-weight:600;font-size:.9rem;margin-top:2px}
    .chart-actions{display:flex;gap:8px;flex-wrap:wrap}
    .rbtn{border:1.6px solid #cfeacc;background:#fff;color:#184b10;border-radius:999px;padding:7px 12px;font-weight:800;cursor:pointer}
    .rbtn.is-active{background:var(--brand);border-color:var(--brand);color:#fff}
    .rbtn:focus{outline:4px solid var(--ring)}
    .chart-wrap{padding:10px 14px 14px;height:260px}
    @media (max-width:820px){ .chart-wrap{height:220px} }
  </style>

  <!-- NUR hinzugefügt: Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <header>
    <img src="https://onecdn.io/media/61c27ecc-efc9-4840-9ff3-d13f96ec1316/full" alt="Logo Raiffeisenmarkt Wiesbach" class="logo" />
  </header>

  <section class="hero" aria-labelledby="h1">
    <h1 id="h1">Heizöl Preisrechner – Raiffeisenmarkt Wiesbach im Saarland</h1>
    <p>Berechnen Sie Ihren Heizölpreis schnell und bequem – ganz einfach online und sofort verfügbar.</p>
    <!-- Bild entfernt: hero-media wurde bewusst weggelassen (Desktop & Mobil) -->
  </section>

  <section class="steps" aria-label="Schritte">
    <ol>
      <li><div class="dot">1</div><div class="txt"><strong>Daten eingeben</strong><br><span>PLZ, Liefermenge &amp; Versandart wählen</span></div></li>
      <li><div class="dot">2</div><div class="txt"><strong>Preis berechnen</strong><br><span>Individuellen Preis berechnen lassen</span></div></li>
      <li><div class="dot">3</div><div class="txt"><strong>Bestellung abschicken</strong><br><span>Persönliche Daten bestätigen &amp; Formular verbindlich absenden</span></div></li>
      <li><div class="dot">4</div><div class="txt"><strong>Lieferung &amp; Zahlung</strong><br><span>Bezahlung bei Lieferung oder per Vorabüberweisung</span></div></li>
    </ol>
  </section>

  <section class="form-wrap">
    <form id="oilForm" class="form" novalidate>
      <div class="row">
        <div class="form-group">
          <label for="oilRange">Liefermenge (Liter)*</label>
          <div class="number-wrap">
            <div class="unit-input">
              <input
                type="number"
                id="oilRange"
                name="liefermenge"
                min="100"
                max="15000"
                step="100"
                value="500"
                inputmode="numeric"
                required
                placeholder="z. B. 2.000"
              />
              <span class="unit">L</span>
            </div>
            <small class="hint">• Schritte à 100 L •</small>
          </div>
        </div>
        <div class="form-group">
          <label for="plz">Postleitzahl*</label>
          <input type="text" id="plz" name="plz" maxlength="5" inputmode="numeric" pattern="\d{5}" required placeholder="z. B. 66557" />
          <p id="errMsg" style="display:none;color:#b00020;font-weight:600;margin:.35rem 0 0" aria-live="assertive">Die eingegebene PLZ liegt nicht im Liefergebiet.</p>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label for="ablade">Anzahl der Abladestellen*</label>
          <select id="ablade" name="ablade" required>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        <div class="form-group">
          <div class="premium-card" role="group" aria-labelledby="premiumTitle">
            <div class="switch">
              <input type="checkbox" id="premium" aria-describedby="premiumHint" />
              <span class="slider" aria-hidden="true"></span>
              <label for="premium" class="switch-label" id="premiumTitle">Premium Heizöl</label>
            </div>
            <small id="premiumHint" class="muted" style="display:block;color:#315227;margin-top:.3rem">Aufpreis: +1,50 € je 100 L – wird bei der Berechnung berücksichtigt.</small>
            <details>
              <summary>Wissenswertes zu Premium Heizöl</summary>
              <div class="info">
                <p>Für alle Ölheizungen geeignet – nach <a href="https://de.wikipedia.org/wiki/Heiz%C3%B6l" target="_blank" rel="noopener">DIN 51603-1</a>.</p>
                <ul>
                  <li>Mit Additivpaket: reduzierter Verbrauch</li>
                  <li>Längere Lebensdauer der Anlage</li>
                  <li>Weniger Wartungsaufwand</li>
                  <li>Höhere Betriebssicherheit</li>
                  <li>Angenehmer Geruch</li>
                  <li>Umweltschonend (max. 0,005 % Schwefel)</li>
                </ul>
                <p>Das Additiv (Wirkstoff) wird mittels Dosiereinrichtung beim Abtanken beigemischt.</p>
              </div>
            </details>
          </div>
        </div>
      </div>

      <button class="btn" id="submitBtn" type="submit">Preis berechnen</button>
    </form>
  </section>

  <!-- NUR hinzugefügt: Chart-Block -->
  <section class="chart-card" aria-label="Ölpreisverlauf">
    <div class="chart-head">
      <div>
        <div class="chart-title">Ölpreisverlauf</div>
        <div id="oilChartMeta" class="chart-sub">Lade Daten…</div>
      </div>
      <div class="chart-actions" role="group" aria-label="Zeitraum wählen">
        <button type="button" class="rbtn is-active" data-range="3m">3M</button>
        <button type="button" class="rbtn" data-range="6m">6M</button>
        <button type="button" class="rbtn" data-range="1y">1Y</button>
      </div>
    </div>
    <div class="chart-wrap">
      <canvas id="oilChart"></canvas>
    </div>
  </section>

  <footer class="footer">
    <p>© 2025 Raiffeisenmarkt Wiesbach – Alle Rechte vorbehalten</p>
    <p>
      <a href="https://raiffeisenmarkt-wiesbach.onepage.me/impressum" target="_blank" rel="noopener">Impressum</a>
      ·
      <a href="https://raiffeisenmarkt-wiesbach.onepage.me/datenschutzerklarung" target="_blank" rel="noopener">Datenschutzerklärung</a>
    </p>
  </footer>

  <div class="modal" id="chartModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="chartTitle">
    <div class="modal__panel">
      <button class="modal__close" type="button" id="closeChartBtn" aria-label="Popup schließen">×</button>
      <div class="modal__body">
        <h2 id="chartTitle" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden">Preis-Chart</h2>
        <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSgDaArv9UgKthAI2xg0BfJXxqJ6yUCqQZzlbytuz4KAUEPXKAeyteb45S943v2a_Hq4E2XAvidKalW/pubchart?oid=1568395756&amp;format=interactive" title="Preis-Chart (Vollbild)"></iframe>
      </div>
    </div>
  </div>

  <script>
    const oilSlider = document.getElementById('oilRange');
    const FORM = document.getElementById('oilForm');
    const BTN  = document.getElementById('submitBtn');
    const ERR  = document.getElementById('errMsg');

    (function(){
      const MIN = 100, MAX = 15000, STEP = 100;
      function normalize(v){
        let n = parseInt(String(v).replace(/\D+/g,''), 10);
        if (isNaN(n)) n = MIN;
        n = Math.round(n / STEP) * STEP;
        n = Math.max(MIN, Math.min(MAX, n));
        return n;
      }
      if(oilSlider){
        oilSlider.addEventListener('blur',  ()=> oilSlider.value = normalize(oilSlider.value));
        oilSlider.addEventListener('change',()=> oilSlider.value = normalize(oilSlider.value));
      }
    })();

    const area1 = ["66260","66262","66265","66272","66273","66274","66275","66280","66281","66282","66284","66287","66288","66289","66292","66293","66294","66295","66299","66337","66338","66340","66341","66346","66511","66512","66513","66514","66515","66516","66517","66518","66519","66520","66521","66522","66531","66538","66539","66540","66549","66550","66552","66553","66557","66558","66559","66560","66564","66565","66566","66567","66571","66572","66573","66575","66578","66579","66580","66583","66584","66585","66587","66589","66591","66592","66593","66594","66595","66596","66597","66630","66631","66632","66633","66636","66641","66642","66643","66646","66791","66792","66793","66807","66809","66811","66812","66813","66814","66819","66822","66832","66833","66835","66836","66839"];
    const area2 = ["66459","66640","66629","66701","66740","66763","66773","66774","66775","66777","66787","66780","66794","66795","66798","66802","66000","66001","66002","66003","66004","66005","66006","66007","66008","66009","66010","66011","66012","66013","66014","66015","66016","66017","66019","66020","66021","66022","66023","66024","66025","66026","66027","66028","66029","66030","66031","66032","66033","66042","66043","66044","66045","66046","66047","66051","66053","66055","66057","66059","66060","66061","66063","66065","66067","66090","66091","66092","66093","66094","66095","66099","66100","66101","66102","66103","66104","66105","66106","66107","66108","66109","66111","66113","66115","66117","66119","66121","66123","66125","66126","66127","66128","66129","66130","66131","66132","66133","66140","66141","66142","66143","66150","66200","66259","66353","66354","66355","66359","66361","66362","66363","66364","66365","66366","66367","66368","66369","66370","66376","66377","66386","66803","66804","66806","66333"];
    const area3 = ["66687","66129","66130","66629","66271","66352","66399","66424","66679","66693","66706","66709","66780","66798","66802","66440","66453","66620","66625","66663"];

    function areaByPlz(plz){
      if (area1.includes(plz)) return 'Area 1';
      if (area2.includes(plz)) return 'Area 2';
      if (area3.includes(plz)) return 'Area 3';
      return '';
    }

    document.getElementById('plz').addEventListener('input', (e)=>{
      const plz = e.target.value.replace(/\D+/g,'').slice(0,5);
      e.target.value = plz;
      const a = areaByPlz(plz);
      ERR.style.display = a ? 'none' : (plz.length === 5 ? 'block' : 'none');
    });

    const premiumCheckbox = document.getElementById('premium');
    const premiumSlider   = document.querySelector('.switch .slider');
    if (premiumSlider){ premiumSlider.addEventListener('click', ()=>{ premiumCheckbox.checked = !premiumCheckbox.checked; }); }

    FORM.addEventListener('submit', async (ev)=>{
      ev.preventDefault();

      const liefermenge   = parseInt(oilSlider.value,10);
      const plz           = document.getElementById('plz').value.trim();
      const abladestellen = parseInt(document.getElementById('ablade').value,10);
      const premium       = document.getElementById('premium').checked;
      const area          = areaByPlz(plz);

      if (!area){ ERR.style.display='block'; return; }

      const payload = { liefermenge, plz, abladestellen, area, premium };

      BTN.disabled = true; BTN.textContent = 'Berechne…';
      try{
        const res = await fetch('https://n8n.srv899952.hstgr.cloud/webhook/oelrechner',{
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(payload)
        });
        const text = await res.text();
        if(!res.ok) throw new Error('HTTP '+res.status+' | '+text.slice(0,200));
        let data; try{ data = JSON.parse(text) } catch{ throw new Error('Antwort kein JSON: '+text.slice(0,200)); }
        const result = Array.isArray(data) ? data[0] : data;

        sessionStorage.setItem('oelForm', JSON.stringify({
          eingabe: { liefermenge, plz, abladestellen, area, premium },
          berechnung: result,
          timestamp: Date.now()
        }));

        window.location.href = './seite2.html';
      } catch(err){
        alert('Fehler: '+err.message);
      } finally {
        BTN.disabled = false; BTN.textContent = 'Preis berechnen';
      }
    });

    const openChartBtn = document.getElementById('openChartBtn');
    const chartModal   = document.getElementById('chartModal');
    const closeChartBtn= document.getElementById('closeChartBtn');

    function openModal(){
      chartModal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeModal(){
      chartModal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    if(openChartBtn){ openChartBtn.addEventListener('click', openModal); }
    if(closeChartBtn){ closeChartBtn.addEventListener('click', closeModal); }
    if(chartModal){ chartModal.addEventListener('click', (e)=>{ if(e.target===chartModal) closeModal(); }); }
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

    /* ===== NUR hinzugefügt: Chart-Logik (ändert keine bestehende Logik) ===== */
    (function initOilChart(){
      const API = 'https://n8n.srv899952.hstgr.cloud/webhook/oelpreisverlauf';
      const canvas = document.getElementById('oilChart');
      const metaEl = document.getElementById('oilChartMeta');
      if(!canvas || !window.Chart) return;

      let chart;

      function fmtDE(iso){
        if(!iso || typeof iso !== 'string') return '';
        const parts = iso.split('-');
        if(parts.length !== 3) return iso;
        const [y,m,d] = parts;
        return `${d}.${m}.${y}`;
      }

      async function load(range){
        try{
          if(metaEl) metaEl.textContent = 'Lade Daten…';
          const res = await fetch(`${API}?range=${encodeURIComponent(range)}`, { cache:'no-store' });
          const data = await res.json();

          const points = Array.isArray(data?.points) ? data.points : [];
          const labels = points.map(p => fmtDE(p.date));
          const values = points.map(p => Number(p.price));
          const finite = values.filter(v => Number.isFinite(v));
          const vMin = finite.length ? Math.min(...finite) : 0;
          const vMax = finite.length ? Math.max(...finite) : 200;

          // Padding macht die Wellen sichtbar (aber bleibt im 0–200 Rahmen)
          const span = Math.max(1, vMax - vMin);
          const pad  = Math.min(18, Math.max(4, span * 0.5));

          const yMin = Math.max(0,  vMin - pad);
          const yMax = Math.min(200, vMax + pad);


          const last = data?.last?.date ? fmtDE(data.last.date) : '—';
          if(metaEl) metaEl.textContent = `Zeitraum: ${String(range).toUpperCase()} · Letzter Stand: ${last}`;

          const ctx = canvas.getContext('2d');
          if(chart) chart.destroy();

          chart = new Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [{
                label: 'Tagespreis',
                data: values,
                tension: 0.35,
                borderWidth: 3,
                pointRadius: 0,
                pointHitRadius: 14,
                fill: true
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: { mode: 'index', intersect: false },
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: (c) => ` ${Number(c.parsed.y).toLocaleString('de-DE')} €`
                  }
                }
              },
              scales: {
                x: { grid: { display: false }, ticks: { maxTicksLimit: 8 } },
                y: {
                  min: 0,
                  max: 200,
                  ticks: { callback: (v)=> `${v}` }
                }
              }
            }
          });

        } catch(e){
          if(metaEl) metaEl.textContent = 'Fehler beim Laden der Chart-Daten';
          console.error(e);
        }
      }

      function setActive(btn){
        document.querySelectorAll('.chart-actions .rbtn').forEach(b => b.classList.remove('is-active'));
        btn.classList.add('is-active');
      }

      document.querySelectorAll('.chart-actions .rbtn').forEach(btn => {
        btn.addEventListener('click', () => {
          const range = btn.getAttribute('data-range') || '3m';
          setActive(btn);
          load(range);
        });
      });

      load('3m');
    })();
  </script>
</body>
</html>
