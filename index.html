<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ölpreisrechner</title>
  <link rel="icon" href="https://onecdn.io/media/96d496c9-3b9e-451e-ab59-264290e9b0cf/full" sizes="any" />
  <meta name="theme-color" content="#6EC054" />

  <style>
    :root{
      --brand:#6EC054; --brand-dark:#4c7f2d; --ink:#222; --bg:#f7faf7; --card:#ffffff;
      --shadow:0 12px 30px rgba(0,0,0,.08);
      --chart-max-width:1000px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui;background:var(--bg);color:var(--ink)}
    header{background:var(--brand);padding:26px;text-align:center}
    .logo{height:40px}

    .hero{padding:2rem 1rem;background:#fff;text-align:center}
    .hero h1{background:var(--brand);color:#fff;display:inline-block;padding:.5rem .9rem;border-radius:10px}

    .chart-card{
      max-width:var(--chart-max-width);
      margin:2rem auto;
      background:#fff;
      border-radius:16px;
      box-shadow:var(--shadow);
      border:1px solid #e8efe3;
      overflow:hidden;
    }
    .chart-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px;
      border-bottom:1px solid #eef2ea;
      gap:10px;
      flex-wrap:wrap;
    }
    .range-buttons{display:flex;gap:8px}
    .range-buttons button{
      border:1px solid #d9e3d3;
      background:#fff;
      border-radius:999px;
      padding:6px 12px;
      font-weight:700;
      cursor:pointer;
    }
    .range-buttons button.active{
      background:var(--brand);
      color:#fff;
      border-color:var(--brand);
    }
    .chart-body{padding:12px}
    canvas{max-width:100%}

    footer{background:var(--brand);color:#fff;text-align:center;padding:20px}
  </style>
</head>

<body>

<header>
  <img src="https://onecdn.io/media/61c27ecc-efc9-4840-9ff3-d13f96ec1316/full" class="logo" alt="">
</header>

<section class="hero">
  <h1>Heizöl-Preisverlauf</h1>
</section>

<section class="chart-card">
  <div class="chart-head">
    <strong>Preisverlauf</strong>
    <div class="range-buttons">
      <button data-range="3m" class="active">3 Monate</button>
      <button data-range="6m">6 Monate</button>
      <button data-range="1y">1 Jahr</button>
      <button data-range="3y">3 Jahre</button>
    </div>
  </div>
  <div class="chart-body">
    <canvas id="oilChart" height="120"></canvas>
  </div>
</section>

<footer>
  © 2025 Raiffeisenmarkt Wiesbach
</footer>

<!-- Chart.js + Date Adapter -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>

<script>
let chart;

async function loadChart(range){
  const res = await fetch(
    'https://n8n.srv899952.hstgr.cloud/webhook/oelchart?range=' + range
  );
  const json = await res.json();

  const points = json.labels.map((d,i)=>({
    x: d,      // YYYY-MM-DD
    y: json.data[i]
  }));

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById('oilChart'),{
    type:'line',
    data:{
      datasets:[{
        data: points,
        borderColor:'#6EC054',
        backgroundColor:'rgba(110,192,84,.15)',
        fill:true,
        tension:.35,
        pointRadius:0
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{
        x:{
          type:'time',
          time:{
            unit:'month',
            displayFormats:{ month:'MMM yyyy' }
          },
          ticks:{
            maxRotation:0,
            autoSkip:true
          },
          grid:{display:false}
        },
        y:{
          ticks:{callback:v=>v+' €'}
        }
      }
    }
  });

  document
    .querySelectorAll('.range-buttons button')
    .forEach(b=>b.classList.toggle('active', b.dataset.range===range));
}

document
  .querySelectorAll('.range-buttons button')
  .forEach(b=>b.addEventListener('click',()=>loadChart(b.dataset.range)));

loadChart('3m');
</script>

</body>
</html>
