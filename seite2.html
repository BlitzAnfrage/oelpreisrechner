<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Preisübersicht – Heizöl</title>
  <style>
    :root{
      --brand:#6EC054; --brand-2:#4c7f2d; --ink:#1f2b1c; --bg:#f7faf7; --card:#fff;
      --muted:#66736a; --ring:rgba(110,192,84,.25); --shadow:0 12px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html{font-size:15px;overflow-x:hidden}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:var(--bg);color:var(--ink)}
    header{background:var(--brand);padding:22px 18px;color:#fff;display:flex;align-items:center;justify-content:center}
    .logo{height:40px}

    .wrap{max-width:1040px;margin:0 auto;padding:18px}

    .hero{background:#fff;border:1px solid #e8efe3;border-radius:14px;box-shadow:var(--shadow);padding:12px 16px;margin:16px auto}
    .hero h1{margin:.2rem 0;color:#184b10;font-size:clamp(1.2rem,2.2vw,1.6rem)}
    .hero p{margin:.25rem 0 .4rem;color:#2a2d29}

    .offer{margin:.6rem 0 0;color:#2a2d29}
    .features{list-style:none;padding:0;margin:.45rem 0 0;display:grid;gap:.35rem}
    .features li{position:relative;padding-left:18px}
    .features li::before{content:"";position:absolute;left:0;top:.45em;width:8px;height:8px;background:var(--brand);border-radius:50%;box-shadow:0 0 0 0 rgba(110,192,84,.6);animation:pulse 1.9s ease-out infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(110,192,84,.6)}70%{box-shadow:0 0 0 10px rgba(110,192,84,0)}100%{box-shadow:0 0 0 0 rgba(110,192,84,0)}}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:820px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid #e8efe3;border-radius:14px;box-shadow:var(--shadow)}
    .card .hdr{padding:14px 16px;border-bottom:1px solid #eef3ec;display:flex;align-items:center;justify-content:space-between}
    .card .body{padding:12px 16px}
    .badge{display:inline-flex;gap:6px;align-items:center;background:#e8f6e4;border:1px solid #cfeacc;color:#13470e;border-radius:999px;padding:4px 10px;font-weight:700;font-size:.78rem}

    .rows .row{display:flex;justify-content:space-between;gap:12px;padding:9px 0;border-bottom:1px dashed #eef2ee}
    .rows .row:last-child{border-bottom:0}
    .k{color:var(--muted)} .v{font-weight:700}

    .total{padding:14px 16px;background:#fbfffb;border-top:1px solid #eef3ec;border-bottom-left-radius:14px;border-bottom-right-radius:14px}
    .total h2{margin:.1rem 0 .5rem;font-size:1.35rem}
    .muted{color:#748277;font-size:.88rem}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#fff;color:#184b10;border:1.6px solid #cfeacc}
    .btn:focus{outline:4px solid var(--ring)}

    .order-card .body{padding:16px}
    .order-form{display:grid;gap:16px}
    .fieldset{border:1px solid #e8efe3;border-radius:12px;padding:14px;background:#fbfdf9}
    .legend-title{font-weight:700;margin:0 0 12px;color:#184b10}
    .choices{display:flex;flex-wrap:wrap;gap:10px}
    .choice{display:flex;align-items:center;gap:8px;background:#fff;border:1px solid #d9e3d3;border-radius:10px;padding:8px 12px}

    .form-grid{display:grid;grid-template-columns:1fr 1fr;column-gap:16px;row-gap:16px;align-items:start}
    .form-grid>div{display:flex;flex-direction:column;gap:6px}
    .form-grid .form-grid{grid-column:1 / -1}
    .form-grid .form-grid>div{display:flex;flex-direction:column;gap:6px}
    @media (max-width:820px){.form-grid{grid-template-columns:1fr}}

    label{font-weight:600;font-size:.92rem;margin:0;color:#1f2b1c}
    input[type="text"], input[type="email"], input[type="tel"], textarea, select{
      border:1.7px solid #d9e3d3;border-radius:10px;padding:10px 12px;font-size:.95rem;outline:none;transition:.2s;background:#fff
    }
    textarea{min-height:100px;resize:vertical}
    input:focus, textarea:focus, select:focus{border-color:var(--brand-2);box-shadow:0 0 0 4px var(--ring)}

    .checkline{display:flex;align-items:flex-start;gap:10px;margin-top:6px}
    .checkline input{margin-top:3px}
    .order-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}

    .footer{margin-top:34px;background:var(--brand);color:#fff;text-align:center;padding:24px 12px;font-size:.95rem}
  </style>
</head>
<body>
  <header>
    <img class="logo" src="https://onecdn.io/media/61c27ecc-efc9-4840-9ff3-d13f96ec1316/full" alt="Raiffeisen Logo" />
  </header>

  <div class="wrap">
    <section class="hero">
      <h1>Ergebnis Heizölpreis</h1>
      <p id="sub">Berechnet am <span id="datum">—</span></p>
      <div class="offer">
        <p>Nach Ihrer Bestellung rufen wir Sie innerhalb von 1–2 Werktagen an und vereinbaren einen individuellen Liefertermin.</p>
        <ul class="features">
          <li>Individuelle Terminvereinbarung</li>
          <li>Tankwagengröße inkl. kleiner TKW</li>
          <li>Schlauchlänge bis 40m</li>
        </ul>
      </div>
    </section>

    <div class="grid">
      <div class="card" id="cardA">
        <div class="hdr">
          <strong>Eingaben</strong>
          <span class="badge" id="premiumBadge" hidden>Premium</span>
        </div>
        <div class="body rows">
          <div class="row"><div class="k">PLZ</div><div class="v" id="plz">—</div></div>
          <div class="row"><div class="k">Liefermenge</div><div class="v" id="liefermenge">—</div></div>
          <div class="row"><div class="k">Abladestellen</div><div class="v" id="ablade">—</div></div>
        </div>
      </div>

      <div class="card" id="cardB">
        <div class="hdr"><strong>Preis je 100&nbsp;L </strong><span id="currency">EUR</span></div>
        <div class="body rows">
          <div class="row"><div class="k">Endpreis je 100&nbsp;L</div><div class="v" id="preis100">—</div></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="hdr"><strong>Summe & Steuern</strong></div>
      <div class="body rows">
        <div class="row"><div class="k">Warenwert netto</div><div class="v" id="warenwert">—</div></div>
        <div class="row"><div class="k">Gefahrgutzuschläge / Lieferpauschale</div><div class="v" id="pauschale">—</div></div>
        <div class="row"><div class="k">Zwischensumme netto</div><div class="v" id="netto">—</div></div>
        <div class="row"><div class="k">zzgl. MwSt.</div><div class="v" id="mwst">—</div></div>
      </div>
      <div class="total">
        <h2 id="brutto">Gesamtpreis: —</h2>
        <div class="actions">
          <button class="btn" id="btnPrint" type="button">PDF / Drucken</button>
          <a class="btn secondary" href="./index.html">Neue Berechnung</a>
        </div>
        <p class="muted">Alle Angaben ohne Gewähr.</p>
      </div>
    </div>

    <div class="card order-card" style="margin-top:14px">
      <div class="hdr"><strong>Jetzt verbindlich bestellen</strong></div>
      <div class="body">
        <form class="order-form" id="orderForm" novalidate>
          <section class="fieldset">
            <p class="legend-title">Zahlungsmethode</p>
            <div class="choices">
              <label class="choice"><input type="radio" name="payment" value="Barzahlung" required> Barzahlung</label>
              <label class="choice"><input type="radio" name="payment" value="EC-Karte"> EC‑Karte</label>
              <label class="choice"><input type="radio" name="payment" value="Vorabüberweisung"> Vorabüberweisung</label>
            </div>
          </section>

          <section class="fieldset">
            <p class="legend-title">Lieferzeit</p>
            <div class="choices">
              <label class="choice"><input type="radio" name="delivery" value="ca. 2-3 Wochen" required> ca. 2–3 Wochen</label>
              <label class="choice"><input type="radio" name="delivery" value="1-2 Werktage (Preis auf Anfrage)"> 1–2 Werktage <small>&gt;Preis auf Anfrage&lt; (~ +100 €)</small></label>
            </div>
          </section>

          <section class="fieldset">
            <p class="legend-title">Kundendaten</p>
            <div class="form-grid">
              <div>
                <label for="fn">Vorname *</label>
                <input id="fn" name="vorname" type="text" required>
              </div>
              <div>
                <label for="ln">Name *</label>
                <input id="ln" name="name" type="text" required>
              </div>
              <div>
                <label for="company">Firma</label>
                <input id="company" name="firma" type="text">
              </div>
              <div>
                <label for="addr">Adresse *</label>
                <input id="addr" name="adresse" type="text" required>
              </div>
              <div>
                <label for="zip">Postleitzahl *</label>
                <input id="zip" name="plz" type="text" inputmode="numeric" pattern="\d{5}" placeholder="66557" required>
              </div>
              <div>
                <label for="city">Stadt *</label>
                <input id="city" name="stadt" type="text" required>
              </div>
              <div>
                <label for="mail">E‑Mailadresse *</label>
                <input id="mail" name="email" type="email" required>
              </div>
              <div>
                <label for="phone">Telefonnummer *</label>
                <input id="phone" name="telefon" type="tel" required>
              </div>
              <div class="form-grid" style="grid-template-columns:1fr">
                <div>
                  <label for="note">Bemerkungen</label>
                  <textarea id="note" name="bemerkungen" placeholder="z. B. Tank ist schwer zugänglich…"></textarea>
                </div>
              </div>
            </div>

            <div class="checkline">
              <input id="agb" type="checkbox" required>
              <label for="agb">AGB akzeptieren *</label>
            </div>
            <div class="checkline">
              <input id="nl" type="checkbox">
              <label for="nl">Newsletter abonnieren</label>
            </div>
            <div class="checkline">
              <input id="abo" type="checkbox">
              <label for="abo">Ich möchte die Lieferpauschale sparen. Bitte informieren Sie mich unverbindlich über die Möglichkeiten des Heizöl‑Abos!</label>
            </div>

            <div class="order-actions">
              <button class="btn" id="btnOrder" type="button">Jetzt verbindlich bestellen</button>
              <small class="muted">Hinweis: Test_Rechner</small>
            </div>
          </section>
        </form>
      </div>
    </div>
  </div>

  <footer class="footer">
    <p>© 2025 Raiffeisenmarkt Wiesbach – Alle Rechte vorbehalten</p>
  </footer>

  <script>
    const euro = (v)=>{ const n = Number(v); if(!isFinite(n)) return '—'; return n.toLocaleString('de-DE',{style:'currency',currency:'EUR'}); }
    const numf = (v)=>{ const n = Number(v); if(!isFinite(n)) return '—'; return n.toLocaleString('de-DE'); }
    function fill(id, val){ const el = document.getElementById(id); if(el) el.textContent = val; }

    let store = {}; try{ store = JSON.parse(sessionStorage.getItem('oelForm')||'{}'); }catch{}
    const b = store?.berechnung || {}; const meta = b.meta||{}; const inp=b.input||{}; const k=b.komponentenPro100L||{}; const t=b.totals||{}; const f=b.formatted||{};

    if(!Object.keys(b).length){
      document.querySelector('.hero h1').textContent = 'Keine Daten gefunden';
      document.getElementById('sub').innerHTML = 'Bitte starten Sie die Berechnung erneut.';
    }

    const dstr = meta.generatedAt ? new Date(meta.generatedAt).toLocaleDateString('de-DE') : new Date().toLocaleDateString('de-DE');
    fill('datum', dstr);
    const badge = document.getElementById('premiumBadge');
    if(inp.premium) badge.hidden = false; else badge.hidden = true;

    fill('plz', inp.plz||'—');
    fill('liefermenge', f.liefermenge || (numf(inp.liefermengeL)+' L'));
    fill('ablade', numf(inp.abladestellen||1));

    fill('preis100', f.endpreisPro100L || euro(k.endpreisPro100L));

    const lpText = (t.lieferpauschaleEinheit!=null && t.lieferpauschaleAnzahl!=null)
      ? `${t.lieferpauschaleAnzahl} × ${euro(t.lieferpauschaleEinheit)} = ${euro(t.lieferpauschale)}`
      : (f.lieferpauschale || euro(t.lieferpauschale));

    fill('warenwert', f.warenwertNetto || euro(t.warenwertNetto));
    fill('pauschale', lpText);
    fill('netto', f.zwischensummeNetto || euro(t.zwischensummeNetto));
    const mwstLabel = (t.mwstSatz!=null? t.mwstSatz: 19);
    fill('mwst', (f.mwstBetrag || euro(t.mwstBetrag)) + ` (${mwstLabel}%)`);
    fill('brutto', `Gesamtpreis: ${f.gesamtBrutto || euro(t.gesamtBrutto)}`);

    document.getElementById('btnPrint').addEventListener('click', ()=> window.print());

    const zipEl = document.getElementById('zip'); if(zipEl && inp.plz) zipEl.value = inp.plz;

    const btnOrder = document.getElementById('btnOrder');
    btnOrder.addEventListener('click', async ()=>{
      const form = document.getElementById('orderForm');
      if(!form.reportValidity()) return;
      const payload = {
        order:{
          payment: form.elements['payment']?.value || '',
          delivery: form.elements['delivery']?.value || '',
          vorname: document.getElementById('fn').value.trim(),
          name: document.getElementById('ln').value.trim(),
          firma: document.getElementById('company').value.trim(),
          adresse: document.getElementById('addr').value.trim(),
          plz: document.getElementById('zip').value.trim(),
          stadt: document.getElementById('city').value.trim(),
          email: document.getElementById('mail').value.trim(),
          telefon: document.getElementById('phone').value.trim(),
          bemerkungen: document.getElementById('note').value.trim(),
          agb: document.getElementById('agb').checked,
          newsletter: document.getElementById('nl').checked,
          abo_interesse: document.getElementById('abo').checked
        },
        context:{
          plz: inp.plz,
          liefermengeL: inp.liefermengeL,
          abladestellen: inp.abladestellen,
          premium: inp.premium,
          endpreisPro100L: k.endpreisPro100L ?? null,
          totals: t,
          formatted: f
        },
        meta:{ page:'seite2', submittedAt: new Date().toISOString() }
      };

      btnOrder.disabled = true; const oldTxt = btnOrder.textContent; btnOrder.textContent = 'Senden…';
      try{
        const res = await fetch('https://n8n.srv899952.hstgr.cloud/webhook-test/oelrechner-bestellung',{
          method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
        });
        const text = await res.text();
        if(!res.ok) throw new Error('HTTP '+res.status+' | '+text.slice(0,200));
        alert('Bestellung erfolgreich.');
      }catch(err){
        alert('Fehler beim Senden: '+err.message);
      }finally{
        btnOrder.disabled = false; btnOrder.textContent = oldTxt;
      }
    });
  </script>
</body>
</html>